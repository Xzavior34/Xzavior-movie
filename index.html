<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>xzavior ‚Äî Home</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    :root {
      --red: #ff0000;
      --red-dark: #cc0000;
      --bg-main: linear-gradient(135deg, #0a0a0a 0%, #1a0a1a 100%);
      --glass-bg: rgba(15, 15, 15, 0.95);
      --blur: blur(10px);
      --header-height: 54px;
      --avatar-size: 32px;
      --avatar-border: 1.5px solid rgba(255, 0, 0, 0.3);
      --avatar-border-hover: #ff0000;
      --card-radius: 0;
      --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-main);
      color: #fff;
      min-height: 100vh;
      width: 100%;
      overflow-x: hidden;
    }

    /* Header - compact, single line, always at top */
    .yt-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      height: var(--header-height);
      background: var(--glass-bg);
      backdrop-filter: var(--blur);
      -webkit-backdrop-filter: var(--blur);
      color: white;
      border-bottom: 1px solid rgba(255, 0, 0, 0.12);
      box-shadow: 0 2px 16px rgba(0, 0, 0, 0.18);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 10px;
      gap: 8px;
    }
    .yt-header-left, .yt-header-right {
      display: flex;
      align-items: center;
      gap: 7px;
      height: 100%;
    }
    .yt-header-left {
      min-width: 80px;
    }
    .yt-logo {
      display: flex;
      align-items: center;
      text-decoration: none;
      color: inherit;
      font-weight: 700;
      font-size: 20px;
      letter-spacing: -0.5px;
      transition: transform var(--transition);
      height: 100%;
    }
    .yt-logo img {
      height: 22px;
      margin-right: 6px;
      filter: drop-shadow(0 0 8px rgba(255, 0, 0, 0.5));
    }
    .yt-logo .yt-red { 
      color: var(--red);
      text-shadow: 0 0 8px rgba(255, 0, 0, 0.3);
    }
    .yt-search {
      flex: 1 1 0;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 0;
      max-width: 350px;
      margin: 0 7px;
      height: 36px;
    }
    .yt-search-container {
      display: flex;
      width: 100%;
      min-width: 0;
      height: 36px;
    }
    .yt-search input {
      padding: 7px 12px;
      border-radius: 18px 0 0 18px;
      border: 1.2px solid rgba(255,255,255,0.13);
      background: rgba(30,30,30,0.54);
      color: #fff;
      flex: 1 1 0;
      outline: none;
      font-size: 14px;
      height: 100%;
      min-width: 0;
      max-width: 170px;
      transition: var(--transition);
    }
    .yt-search input::placeholder {
      color: rgba(255, 255, 255, 0.35);
      font-size: 13px;
    }
    .yt-search input:focus {
      border-color: rgba(255,0,0,0.36);
      background: rgba(30,30,30,0.85);
      box-shadow: 0 0 10px rgba(255,0,0,0.13);
    }
    .yt-search button {
      border-radius: 0 18px 18px 0;
      border: 1.2px solid rgba(255,255,255,0.13);
      border-left: none;
      background: linear-gradient(135deg, var(--red) 0%, var(--red-dark) 100%);
      color: white;
      padding: 0 13px;
      cursor: pointer;
      font-size: 17px;
      transition: var(--transition);
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .yt-search button:hover {
      background: linear-gradient(135deg, #ff3333 0%, var(--red) 100%);
      box-shadow: 0 0 10px rgba(255,0,0,0.18);
      transform: translateX(1px);
    }
    .icon-btn {
      cursor: pointer;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.10);
      color: white;
      font-size: 18px;
      position: relative;
      padding: 7px;
      transition: var(--transition);
      border-radius: 50%;
      width: 34px;
      height: 34px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .icon-btn:hover {
      background: rgba(255,0,0,0.13);
      border-color: rgba(255,0,0,0.3);
      transform: scale(1.09);
    }
    .notif-badge {
      position: absolute;
      top: 0;
      right: 0;
      background: linear-gradient(135deg, var(--red) 0%, var(--red-dark) 100%);
      color: white;
      font-size: 8px;
      font-weight: bold;
      border-radius: 8px;
      padding: 1.2px 4px;
      min-width: 12px;
      text-align: center;
      box-shadow: 0 1px 5px rgba(255,0,0,0.3);
    }
    .avatar {
      width: var(--avatar-size);
      height: var(--avatar-size);
      border-radius: 50%;
      cursor: pointer;
      border: var(--avatar-border);
      transition: var(--transition);
      object-fit: cover;
      background: #191919;
    }
    .avatar:hover {
      border-color: var(--avatar-border-hover);
      box-shadow: 0 0 6px rgba(255,0,0,0.19);
      transform: scale(1.08);
    }
    /* Main content offset by header height */
    .yt-main {
      width: 100%;
      max-width: 100%;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      padding-top: var(--header-height);
      box-sizing: border-box;
      display: block;
    }
    .video-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 12px;
      margin-bottom: 28px;
      width: 100%;
      max-width: 100%;
      margin-left: 0;
      margin-right: 0;
      padding: 0 3px;
      box-sizing: border-box;
      overflow-x: hidden;
    }
    .video-card {
      cursor: pointer;
      background: rgba(20, 20, 20, 0.6);
      border-radius: var(--card-radius);
      overflow: hidden;
      transition: var(--transition);
      border: none;
      border-right: 1px solid rgba(255,255,255,0.02);
      border-bottom: 1px solid rgba(255,255,255,0.02);
      position: relative;
    }
    .video-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255,0,0,0.08) 0%, transparent 100%);
      opacity: 0;
      transition: opacity var(--transition);
      pointer-events: none;
    }
    .video-card:hover {
      transform: scale(1.03);
      box-shadow: 0 4px 16px rgba(255,0,0,0.18);
      z-index: 10;
    }
    .video-card:hover::before {
      opacity: 1;
    }
    .video-card:focus-visible {
      outline: 2px solid var(--red);
      outline-offset: -2px;
      z-index: 10;
    }
    .video-thumbnail-wrapper {
      position: relative;
      overflow: hidden;
    }
    .video-thumbnail {
      width: 100%;
      aspect-ratio: 16/9;
      object-fit: cover;
      background: linear-gradient(135deg, #1a1a1a 0%, #2a1a2a 100%);
      transition: transform var(--transition);
      display: block;
    }
    .video-card:hover .video-thumbnail {
      transform: scale(1.08);
    }
    .video-card p {
      margin: 0;
      padding: 10px;
      font-size: 13px;
      color: #fff;
      font-weight: 500;
      line-height: 1.35;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      min-height: 46px;
      background: rgba(15, 15, 15, 0.8);
    }
    #loader {
      text-align: center;
      padding: 18px;
      color: rgba(255,255,255,0.6);
      font-size: 14px;
    }
    .loader-spinner {
      display: inline-block;
      width: 24px;
      height: 24px;
      border: 2.5px solid rgba(255,255,255,0.09);
      border-top-color: var(--red);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-bottom: 8px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    @media screen and (max-width: 600px) {
      .yt-header {
        padding: 0 3px;
        gap: 4px;
        height: 46px;
      }
      .yt-logo {
        font-size: 16px;
      }
      .yt-logo img {
        height: 16px;
        margin-right: 4px;
      }
      .yt-search {
        max-width: 120px;
        min-width: 0;
        margin: 0 2px;
        height: 30px;
      }
      .yt-search-container {
        height: 30px;
      }
      .yt-search input {
        padding: 5px 7px;
        font-size: 12px;
        border-radius: 14px 0 0 14px;
        max-width: 80px;
      }
      .yt-search button {
        padding: 0 7px;
        font-size: 15px;
        border-radius: 0 14px 14px 0;
      }
      .icon-btn {
        width: 26px;
        height: 26px;
        font-size: 15px;
        padding: 3.5px;
      }
      .avatar {
        width: 22px;
        height: 22px;
      }
    }
  </style>
</head>
<body>
  <header class="yt-header" role="banner">
    <div class="yt-header-left">
      <a href="index.html" class="yt-logo" aria-label="xzavior home">
        <img src="assets/logo.svg" alt="xzavior logo" onerror="this.style.display='none'">
        <span><span class="yt-red">x</span>zavior</span>
      </a>
    </div>
    <form id="searchForm" class="yt-search" role="search" autocomplete="off">
      <div class="yt-search-container">
        <input 
          id="searchInput" 
          type="search" 
          placeholder="Search..." 
          aria-label="Search videos"
        >
        <button type="submit" aria-label="Search">üîç</button>
      </div>
    </form>
    <div class="yt-header-right">
      <button class="icon-btn" aria-label="Notifications (99+ unread)" id="notifBtn" type="button">
        üîî<span class="notif-badge" aria-hidden="true">99+</span>
      </button>
      <img class="avatar" src="https://i.pravatar.cc/40" alt="Profile picture" loading="lazy">
    </div>
  </header>

  <main class="yt-main" id="mainContent">
    <div id="videoGrid" class="video-grid" role="list" aria-label="Video feed"></div>
    <div id="loader" aria-live="polite" aria-atomic="true"></div>
  </main>

  <script src="js/youtube.js"></script>
  <script>
    (function() {
      'use strict';
      const grid = document.getElementById('videoGrid');
      const loader = document.getElementById('loader');
      const searchForm = document.getElementById('searchForm');
      const searchInput = document.getElementById('searchInput');
      const notifBtn = document.getElementById('notifBtn');
      let isLoading = false;
      let renderedVideos = new Set();

      notifBtn.addEventListener('click', () => {
        alert('xzavior notification');
      });

      function showLoader(message = 'Loading...') {
        loader.innerHTML = `<div class="loader-spinner"></div><p>${message}</p>`;
      }
      function hideLoader() {
        loader.innerHTML = '';
      }

      function renderVideos(videos) {
        if (!videos?.length) return;
        const fragment = document.createDocumentFragment();
        for (const v of videos) {
          if (renderedVideos.has(v.id)) continue;
          renderedVideos.add(v.id);

          const card = document.createElement('div');
          card.className = 'video-card';
          card.setAttribute('role', 'listitem');
          card.tabIndex = 0;

          const thumbWrapper = document.createElement('div');
          thumbWrapper.className = 'video-thumbnail-wrapper';

          const img = document.createElement('img');
          img.className = 'video-thumbnail';
          img.src = v.thumb;
          img.alt = v.title;
          img.loading = 'lazy';

          const title = document.createElement('p');
          title.textContent = v.title;

          thumbWrapper.appendChild(img);
          card.appendChild(thumbWrapper);
          card.appendChild(title);

          const navigate = () => window.location.href = `watch.html?videoId=${encodeURIComponent(v.id)}`;
          card.addEventListener('click', navigate);
          card.addEventListener('keydown', e => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault(); navigate();
            }
          });

          fragment.appendChild(card);
        }
        grid.appendChild(fragment);
      }

      async function init() {
        try {
          showLoader('Loading trending videos...');
          await youtube.bootstrapInitial();
          renderVideos(Array.from(youtube.getFetched()));
          hideLoader();
        } catch (error) {
          console.error('Failed to load videos:', error);
          loader.innerHTML = '<p style="color:#ff4444;">Failed to load videos. Please refresh the page.</p>';
        }
      }

      // Infinite scroll with debounce
      let scrollTimeout;
      window.addEventListener('scroll', () => {
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(async () => {
          if (isLoading) return;
          if ((window.scrollY + window.innerHeight) >= document.documentElement.scrollHeight - 500) {
            isLoading = true;
            showLoader('Loading more videos...');
            try {
              await youtube.loadMoreGlobal();
              renderVideos(Array.from(youtube.getFetched()));
            } catch (error) {
              console.error('Failed to load more videos:', error);
            } finally {
              hideLoader();
              isLoading = false;
            }
          }
        }, 100);
      }, { passive: true });

      searchForm.addEventListener('submit', e => {
        e.preventDefault();
        const query = searchInput.value.trim();
        if (query) window.location.href = `search.html?q=${encodeURIComponent(query)}`;
      });

      // Keyboard shortcut for search
      window.addEventListener('keydown', e => {
        if (e.key === '/' && document.activeElement !== searchInput) {
          e.preventDefault();
          searchInput.focus();
        }
      });

      window._youtube = youtube; // for debugging
      init();
    })();
  </script>
</body>
    </html>
